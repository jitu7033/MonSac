<%- include('./partials/header') %>

<div class="w-full min-h-screen px-4 sm:px-8 lg:px-20 py-10 bg-gray-100">
  <h1 class="text-2xl sm:text-3xl font-bold mb-6 sm:mb-10">Your Shopping Cart</h1>

  <div class="flex flex-col lg:flex-row gap-10">
    <!-- Left: Cart Items -->
    <div class="w-full lg:w-[65%] space-y-6 sm:space-y-8">
      <% let totalMRP = 0; let totalDiscount = 0; %>

      <% products.forEach((item, index) => { 
        const subtotal = item.price * item.quantity;
        totalMRP += subtotal;
        totalDiscount += item.discount || 0;
      %>
        <div class="flex flex-col sm:flex-row bg-white shadow rounded-lg overflow-hidden">
          <div class="w-full sm:w-40 h-40 flex items-center justify-center">
            <img class="w-full h-full object-contain" src="data:image/jpeg;base64,<%= item.image.toString('base64') %>" alt="">
          </div>
          <div class="flex-1 p-4 sm:p-5 flex flex-col justify-between">
            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-2">
              <h2 class="text-lg sm:text-xl font-semibold"><%= item.name %></h2>
              <p class="text-md sm:text-lg font-semibold text-green-600">â‚¹ <%= item.price %></p>
            </div>

            <!-- Quantity Controls -->
            <div class="flex items-center flex-wrap gap-3 mt-3">
              <form action="/cart/decrease/<%= item._id %>" method="POST">
                <button class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300" type="submit">-</button>
              </form>

              <span class="px-3 font-medium"><%= item.quantity %></span>

              <form action="/cart/increase/<%= item._id %>" method="POST">
                <button class="bg-gray-200 px-3 py-1 rounded hover:bg-gray-300" type="submit">+</button>
              </form>

              <form action="/cart/delete/<%= item._id %>" method="POST">
                <button class="text-red-600 hover:underline ml-4 sm:ml-6" type="submit">ðŸ—‘ Remove</button>
              </form>
            </div>

            <div class="text-sm text-gray-600 mt-2">Subtotal: â‚¹ <%= subtotal %></div>
          </div>
        </div>
      <% }); %>
    </div>

    <!-- Right: Price Breakdown -->
    <div class="w-full lg:w-[35%] bg-white p-5 sm:p-6 rounded-lg shadow">
      <h2 class="text-xl sm:text-2xl font-semibold mb-4 sm:mb-6">Price Breakdown</h2>
      <div class="space-y-3 sm:space-y-4 text-gray-700 text-sm sm:text-base">
        <div class="flex justify-between">
          <span>Total MRP</span>
          <span>â‚¹ <%= totalMRP %></span>
        </div>
        <div class="flex justify-between">
          <span>Total Discount</span>
          <span>- â‚¹ <%= totalDiscount %></span>
        </div>
        <div class="flex justify-between">
          <span>Platform Fee</span>
          <span>â‚¹ 20</span>
        </div>
        <div class="flex justify-between">
          <span>Shipping</span>
          <span class="text-green-600">FREE</span>
        </div>
        <div class="border-t pt-4 flex justify-between font-bold text-base sm:text-lg">
          <span>Total Amount</span>
          <span>â‚¹ <%= totalMRP - totalDiscount + 20 %></span>
        </div>
      </div>
      <form action="/checkout" method="POST" class="mt-6">
        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-md font-semibold">
          Proceed to Checkout
        </button>
      </form>
    </div>
  </div>
</div>

<%- include('./partials/footer') %>
